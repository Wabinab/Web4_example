<head>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>WriteLog</title>

  <!-- Importmap -->
<script type="importmap">
  {
    "imports": {
      "near-api-js": "https://ga.jspm.io/npm:near-api-js@0.44.2/lib/browser-index.js",
      "base-x": "https://ga.jspm.io/npm:base-x@3.0.9/src/index.js",
      "bn.js": "https://ga.jspm.io/npm:bn.js@5.2.0/lib/bn.js",
      "borsh": "https://ga.jspm.io/npm:borsh@0.6.0/lib/index.js",
      "bs58": "https://ga.jspm.io/npm:bs58@4.0.1/index.js",
      "buffer": "https://ga.jspm.io/npm:@jspm/core@2.0.0-beta.19/nodelibs/browser/buffer.js",
      "capability": "https://ga.jspm.io/npm:capability@0.2.5/index.js",
      "capability/es5": "https://ga.jspm.io/npm:capability@0.2.5/es5.js",
      "crypto": "https://ga.jspm.io/npm:@jspm/core@2.0.0-beta.19/nodelibs/browser/crypto.js",
      "depd": "https://ga.jspm.io/npm:depd@2.0.0/lib/browser/index.js",
      "error-polyfill": "https://ga.jspm.io/npm:error-polyfill@0.1.3/index.js",
      "http-errors": "https://ga.jspm.io/npm:http-errors@1.8.1/index.js",
      "inherits": "https://ga.jspm.io/npm:inherits@2.0.4/inherits_browser.js",
      "js-sha256": "https://ga.jspm.io/npm:js-sha256@0.9.0/src/sha256.js",
      "mustache": "https://ga.jspm.io/npm:mustache@4.2.0/mustache.js",
      "o3": "https://ga.jspm.io/npm:o3@1.0.3/index.js",
      "process": "https://ga.jspm.io/npm:@jspm/core@2.0.0-beta.19/nodelibs/browser/process-production.js",
      "safe-buffer": "https://ga.jspm.io/npm:safe-buffer@5.2.1/index.js",
      "setprototypeof": "https://ga.jspm.io/npm:setprototypeof@1.2.0/index.js",
      "statuses": "https://ga.jspm.io/npm:statuses@1.5.0/index.js",
      "text-encoding-utf-8": "https://ga.jspm.io/npm:text-encoding-utf-8@1.0.2/lib/encoding.lib.js",
      "toidentifier": "https://ga.jspm.io/npm:toidentifier@1.0.1/index.js",
      "tweetnacl": "https://ga.jspm.io/npm:tweetnacl@1.0.3/nacl-fast.js",
      "u3": "https://ga.jspm.io/npm:u3@0.1.1/index.js",
      "marked": "https://ga.jspm.io/npm:marked@4.0.17/lib/marked.esm.js"
    }
  }
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script src="https://cdn.jsdelivr.net/highlight.js/latest/highlight.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/latest/styles/github.min.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

<style>.flash-container{position:fixed;top:75px;right:15px;z-index:1000;max-width:25%}.flash-container .flash-message{position:relative;opacity:0;min-height:28px;-webkit-transform:translateX(-20px);-ms-transform:translateX(-20px);transform:translateX(-20px);-webkit-transition:all .5s;-o-transition:all .5s;transition:all .5s;background-color:#fff;color:#2c3433;-webkit-border-radius:0;border-radius:0;-webkit-border-top-right-radius:4px;border-top-right-radius:4px;-webkit-border-bottom-right-radius:4px;border-bottom-right-radius:4px;margin-bottom:10px;padding:5px 35px 5px 20px;-webkit-box-shadow:2px 2px 33px 8px rgba(0,0,0,.1);box-shadow:2px 2px 33px 8px rgba(0,0,0,.1);line-height:1.4;cursor:pointer}.flash-container .flash-message .flash-progress{position:absolute;right:0;top:auto;bottom:0;left:0;width:0;height:3px;opacity:1;background-color:rgba(0,0,0,.15);-webkit-transition:opacity .1s;-o-transition:opacity .1s;transition:opacity .1s}.flash-container .flash-message .flash-progress.is-hidden{opacity:0}.flash-container .flash-message .flash-progress.flash-progress-top{top:0;bottom:auto}.flash-container .flash-message:before{position:absolute;content:"";width:7px;height:100%;top:0;bottom:0;left:-7px;background-color:transparent;-webkit-border-top-left-radius:4px;border-top-left-radius:4px;-webkit-border-bottom-left-radius:4px;border-bottom-left-radius:4px}.flash-container .flash-message:after{position:absolute;content:"";font-family:fontAwesome;top:5px;right:8px;text-align:center;vertical-align:middle;color:#9e9e9e}.flash-container .flash-message.is-visible{opacity:1;-webkit-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0)}.flash-container .flash-message.flash-success .flash-progress{background-color:rgba(76,175,80,.15)}.flash-container .flash-message.flash-success:before{background-color:#4caf50}.flash-container .flash-message.flash-success:after{color:rgba(76,175,80,.5);content:"\F058"}.flash-container .flash-message.flash-warning .flash-progress{background-color:rgba(255,133,27,.15)}.flash-container .flash-message.flash-warning:before{background-color:#ff851b}.flash-container .flash-message.flash-warning:after{color:rgba(255,133,27,.5);content:"\F071"}.flash-container .flash-message.flash-danger .flash-progress,.flash-container .flash-message.flash-error .flash-progress{background-color:rgba(255,65,54,.15)}.flash-container .flash-message.flash-danger:before,.flash-container .flash-message.flash-error:before{background-color:#ff4136}.flash-container .flash-message.flash-danger:after,.flash-container .flash-message.flash-error:after{color:rgba(255,65,54,.5);content:"\F06A"}.flash-container .flash-message.flash-info .flash-progress{background-color:rgba(0,116,217,.15)}.flash-container .flash-message.flash-info:before{background-color:#0074d9}.flash-container .flash-message.flash-info:after{color:rgba(0,116,217,.5);content:"\F05A"}.flash-container .flash-message.flash-bug .flash-progress{background-color:rgba(138,43,226,.15)}.flash-container .flash-message.flash-bug:before{background-color:#8a2be2}.flash-container .flash-message.flash-bug:after{color:rgba(138,43,226,.5);content:"\F188"}.flash-container .flash-message.flash-disabled .flash-progress{background-color:hsla(0,0%,67%,.15)}.flash-container .flash-message.flash-disabled:before{background-color:#aaa}.flash-container .flash-message.flash-disabled:after{color:hsla(0,0%,67%,.5);content:"\F05E"}.flash-container .flash-message.flash-default{padding-right:20px}@media (max-width:1280px){.flash-container{max-width:33.334%}}@media (max-width:768px){.flash-container{max-width:50%}}@media (max-width:480px){.flash-container{right:10px;left:10px;max-width:100%}}.flash-container .flash-message.dark-theme{background-color:#2c3433;color:#fff}.flash-container .flash-message.dark-theme .flash-progress{background-color:hsla(0,0%,100%,.5)}</style>
<script>!function(e){function t(s){if(n[s])return n[s].exports;var i=n[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,e),t&&t.constructor===Object&&(n=t,t=null),this.selector=t,this.options=Object.assign({},e.DEFAULT_OPTIONS,n),this._bag=[],this._setElement(),this._process()}return i(e,[{key:"getBag",value:function(){return this._bag}},{key:"setBag",value:function(e){return this._bag.push(e),this}},{key:"attach",value:function(){var e;return(e=this._bag).push.apply(e,arguments),this._checkLimit(),this}},{key:"detach",value:function(e){return this._bag=this._bag.filter(function(t){return e instanceof FlashMessage&&t!==e}),this}},{key:"_setElement",value:function(){!this.selector||this.selector instanceof Element||this.selector.constructor===String&&(this.selector=document.querySelectorAll(this.selector)||null)}},{key:"_process",value:function(){var e=this;this.selector&&(Array.isArray(this.selector)||this.selector.constructor===NodeList?this.selector.forEach(function(t){return e.setBag(new FlashMessage(t,e.options))}):this.setBag(new FlashMessage(this.selector,this.options)),this._checkLimit())}},{key:"_checkLimit",value:function(){if(this.options.limit&&this._bag.length>this.options.limit)for(var e=0;e<this._bag.length-this.options.limit;++e)this._bag[e].destroy(),this.detach(this._bag[e])}}],[{key:"create",value:function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}},{key:"DEFAULT_OPTIONS",get:function(){return{limit:0}}}]),e}();t.a=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),i=(n.n(s),n(0)),r=n(3),o=n(4);n.n(o);!function(e){void 0!==e&&(e.Flash||(e.Flash=i.a),e.FlashMessage||(e.FlashMessage=r.a))}(window),t.default={Flash:i.a,FlashMessage:r.a}},function(e,t){"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||function(e){"use strict";if("Element"in e){var t="classList",n="prototype",s=e.Element[n],i=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},u=function(e){for(var t=r.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],s=0,i=n.length;i>s;s++)this.push(n[s]);this._updateClassName=function(){e.setAttribute("class",""+this)}},h=u[n]=[],c=function(){return new u(this)};if(a[n]=Error[n],h.item=function(e){return this[e]||null},h.contains=function(e){return e+="",-1!==l(this,e)},h.add=function(){var e,t=arguments,n=0,s=t.length,i=!1;do{e=t[n]+"",-1===l(this,e)&&(this.push(e),i=!0)}while(++n<s);i&&this._updateClassName()},h.remove=function(){var e,t,n=arguments,s=0,i=n.length,r=!1;do{for(e=n[s]+"",t=l(this,e);-1!==t;)this.splice(t,1),r=!0,t=l(this,e)}while(++s<i);r&&this._updateClassName()},h.toggle=function(e,t){e+="";var n=this.contains(e),s=n?!0!==t&&"remove":!1!==t&&"add";return s&&this[s](e),!0===t||!1===t?t:!n},h.toString=function(){return this.join(" ")},i.defineProperty){var _={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(s,t,_)}catch(e){(void 0===e.number||-2146823252===e.number)&&(_.enumerable=!1,i.defineProperty(s,t,_))}}else i[n].__defineGetter__&&s.__defineGetter__(t,c)}}(self),function(){"use strict";var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,s=arguments.length;for(n=0;s>n;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}())},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=(n(0),function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}()),r=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e._CONSTANTS.TYPES.ERROR,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s(this,e),n.constructor===Object&&(i=n,n=e._CONSTANTS.TYPES.ERROR),this.$_element=null,this.setOptions(i),t instanceof Element?(this.$_element=t,this._composeMessage()):(this.message=t,this.type=n),this.$_container=document.querySelector(this.options.container)||null,this._c_timeout=null,this.$_progress=null,this._progress_value=0,this._progress_offset=0,this._progress_interval=null,this._createContainer(),this._createMessage()}return i(e,null,[{key:"_CONSTANTS",get:function(){return{TYPES:{SUCCESS:"success",WARNING:"warning",ERROR:"error",INFO:"info"},THEME:"default",CONTAINER:".flash-container",CLASSES:{CONTAINER:"flash-container",VISIBLE:"is-visible",FLASH:"flash-message",PROGRESS:"flash-progress",PROGRESS_HIDDEN:"is-hidden"}}}},{key:"DEFAULT_OPTIONS",get:function(){return{progress:!1,interactive:!0,timeout:8e3,appear_delay:200,remove_delay:600,container:e._CONSTANTS.CONTAINER,classes:{container:e._CONSTANTS.CLASSES.CONTAINER,visible:e._CONSTANTS.CLASSES.VISIBLE,flash:e._CONSTANTS.CLASSES.FLASH,progress:e._CONSTANTS.CLASSES.PROGRESS,progress_hidden:e._CONSTANTS.CLASSES.PROGRESS_HIDDEN},theme:e._CONSTANTS.THEME,onShow:null,onClick:null,onClose:null}}}]),i(e,[{key:"setOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=Object.assign({},e.DEFAULT_OPTIONS,t),this}},{key:"destroy",value:function(){this._close()}},{key:"_createContainer",value:function(){null!==this.$_container&&document.body.contains(this.$_container)||(this.$_container=document.createElement("div"),this.$_container.classList.add(this.options.classes.container),document.body.firstChild?document.body.insertBefore(this.$_container,document.body.firstChild):document.body.appendChild(this.$_container))}},{key:"_composeMessage",value:function(){this.message=this.$_element.dataset.message||this.$_element.innerHTML||"",this.type=this.$_element.dataset.type||e._CONSTANTS.TYPES.ERROR,void 0!==this.$_element.dataset.progress&&this.setOptions({progress:!0}),this.$_element.classList.add("flash-"+this.type)}},{key:"_createMessage",value:function(){if(this.$_element)this.$_element.querySelector(".thumb")&&this.$_element.classList.add("has-thumb");else{if(this.$_element=document.createElement("div"),this.$_element.classList.add(this.options.classes.flash,"flash-"+this.type),this.$_element.setAttribute("data-type",this.type),this.$_element.setAttribute("data-message",this.message),this.$_element.innerHTML=this.message,this.options.thumb){var e=document.createElement("img");e.classList.add("thumb"),e.src=this.options.thumb,this.$_element.classList.add("has-thumb"),this.$_element.appendChild(e)}this._append()}this._setTheme(),this._hasProgress()&&this._progressBar(),this.$_element.dataset.timeout&&(this.options.timeout=parseInt(this.$_element.dataset.timeout,10)),this._behavior(),!0===this._isInteractive()&&this._bindEvents()}},{key:"_append",value:function(){this.$_container.appendChild(this.$_element)}},{key:"_behavior",value:function(){var e=this;this._run(),window.setTimeout(function(){return e.$_element.classList.add(e.options.classes.visible)},this.options.appear_delay)}},{key:"_run",value:function(){var e=this;this._startProgress(),this._c_timeout=window.setTimeout(function(){return e._close()},this.options.timeout)}},{key:"_stop",value:function(){null!==this._c_timeout&&(window.clearTimeout(this._c_timeout),this._stopProgress(),this._c_timeout=null)}},{key:"_close",value:function(){var e=this;this._stopProgress(),this._isInteractive()&&this._unbindEvents(),this.$_element.classList.remove(this.options.classes.visible),this.$_element.addEventListener("transitionend",function(){e.$_container.removeChild(e.$_element),e._clear()})}},{key:"_clear",value:function(){!this.$_container.children.length&&this.$_container.parentNode.contains(this.$_container)&&this.$_container.parentNode.removeChild(this.$_container)}},{key:"_bindEvents",value:function(){var e=this;this._bindEvent("mouseover",function(t){return e._stop()}),this._bindEvent("mouseleave",function(t){return e._run()}),this._bindEvent("click",function(t){return e._close()})}},{key:"_bindEvent",value:function(e,t){try{this.$_element.addEventListener?this.$_element.addEventListener(e,t,!1):this.$_element.attachEvent("on"+this._getCapitalizedEventName(e),t)}catch(e){throw new Error("FlashMessage._bindEvent - Cannot add event on element - "+e)}}},{key:"_unbindEvents",value:function(){var e=this;this._unbindEvent("mouseover",function(t){return e._stop()}),this._unbindEvent("mouseleave",function(t){return e._run()}),this._unbindEvent("click",function(t){return e._close()})}},{key:"_unbindEvent",value:function(e,t){try{this.$_element.removeEventListener?this.$_element.removeEventListener(e,t,!1):this.$_element.detachEvent("on"+this._getCapitalizedEventName(e),t)}catch(e){throw new Error("FlashMessage._unbindEvent - Cannot remove event on element - "+e)}}},{key:"_isInteractive",value:function(){return Boolean(!0===this.options.interactive)}},{key:"_getCapitalizedEventName",value:function(e){return e.charAt(0).toUpperCase()+e.substr(1)}},{key:"_hasProgress",value:function(){return Boolean(this.options.progress)}},{key:"_progressBar",value:function(){this.$_progress=document.createElement("div"),this.$_progress.classList.add(this.options.classes.progress),this.$_element.appendChild(this.$_progress)}},{key:"_startProgress",value:function(){var e=this;this._hasProgress()&&(this.$_progress||this._progressBar(),this._stopProgress(),this._progress_offset=0,this.$_progress.classList.remove(this.options.classes.progress_hidden),this._progress_interval=window.setInterval(function(){return e._setProgress()},16))}},{key:"_setProgress",value:function(){this.$_progress.style.width=this._progress_value+"%",this._progress_value=(100*this._progress_offset/this.options.timeout).toFixed(2),this._progress_offset+=16,this._progress_value>=100&&this._stopProgress()}},{key:"_stopProgress",value:function(){this._hasProgress()&&this.$_progress&&(this.$_progress.classList.add("is-hidden"),window.clearInterval(this._progress_interval),this._progress_interval=null,this._progress_value=0)}},{key:"_setTheme",value:function(){var t=this.$_element.dataset.theme||this.options.theme||"";t.length&&t!==e._CONSTANTS.THEME&&this.$_element.classList.add(t+"-theme")}}],[{key:"create",value:function(t){return new e(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e._CONSTANTS.TYPES.ERROR,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}},{key:"success",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new e(t,e._CONSTANTS.TYPES.SUCCESS,n)}},{key:"warning",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new e(t,e._CONSTANTS.TYPES.WARNING,n)}},{key:"error",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new e(t,e._CONSTANTS.TYPES.ERROR,n)}},{key:"info",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new e(t,e._CONSTANTS.TYPES.INFO,n)}},{key:"addCustomVerbs",value:function(){for(var t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];n&&n.length&&n.forEach(function(t){e[t]||(e[t]=function(n){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new e(n,t,s)})})}}]),e}();t.a=r},function(e,t){}]);</script>

  <!-- Scripts -->
<script type="module">
import { connect, Contract, keyStores, WalletConnection } from 'near-api-js'
const CONTRACT_NAME = 'contract.wlog.near'

function getConfig(env) {
  switch (env) {

  case 'production':
  case 'mainnet':
    return {
      networkId: 'mainnet',
      nodeUrl: 'https://rpc.mainnet.near.org',
      contractName: CONTRACT_NAME,
      walletUrl: 'https://wallet.near.org',
      helperUrl: 'https://helper.mainnet.near.org',
      explorerUrl: 'https://explorer.mainnet.near.org',
    }
  case 'development':
  case 'testnet':
    return {
      networkId: 'testnet',
      nodeUrl: 'https://rpc.testnet.near.org',
      contractName: CONTRACT_NAME,
      walletUrl: 'https://wallet.testnet.near.org',
      helperUrl: 'https://helper.testnet.near.org',
      explorerUrl: 'https://explorer.testnet.near.org',
    }
  case 'betanet':
    return {
      networkId: 'betanet',
      nodeUrl: 'https://rpc.betanet.near.org',
      contractName: CONTRACT_NAME,
      walletUrl: 'https://wallet.betanet.near.org',
      helperUrl: 'https://helper.betanet.near.org',
      explorerUrl: 'https://explorer.betanet.near.org',
    }
  case 'local':
    return {
      networkId: 'local',
      nodeUrl: 'http://localhost:3030',
      keyPath: `${process.env.HOME}/.near/validator_key.json`,
      walletUrl: 'http://localhost:4000/wallet',
      contractName: CONTRACT_NAME,
    }
  case 'test':
  case 'ci':
    return {
      networkId: 'shared-test',
      nodeUrl: 'https://rpc.ci-testnet.near.org',
      contractName: CONTRACT_NAME,
      masterAccount: 'test.near',
    }
  case 'ci-betanet':
    return {
      networkId: 'shared-test-staging',
      nodeUrl: 'https://rpc.ci-betanet.near.org',
      contractName: CONTRACT_NAME,
      masterAccount: 'test.near',
    }
  default:
    throw Error(`Unconfigured environment '${env}'. Can be configured in src/config.js.`)
  }
}

const nearConfig = getConfig('production')
const near = await connect(Object.assign({ deps: { keyStore: new keyStores.BrowserLocalStorageKeyStore() } }, nearConfig))

// Initializing Wallet based Account. It can work with NEAR testnet wallet that
// is hosted at https://wallet.testnet.near.org
window.walletConnection = new WalletConnection(near)

// Getting the Account ID. If still unauthorized, it's just empty string
window.accountId = window.walletConnection.getAccountId()

// Initializing our contract APIs by contract name and configuration
window.contract = await new Contract(window.walletConnection.account(), nearConfig.contractName, {
  // View methods are read only. They don't modify the state, but usually return some value.
  viewMethods: ['get_item', 'get_items_by_newest', 'get_items_by_owner', 'est_storage', 'get_tip'],

  // Change methods can modify the state. But you don't receive the returned value when called.
  changeMethods: ['register_log', 'tip'],
})

function logout() {
  window.walletConnection.signOut()
  // reload page
  window.location.replace(window.location.origin + window.location.pathname)
}

function login() {
  // Allow the current app to make calls to the specified contract on the
  // user's behalf.
  // This works by creating a new access key for the user's account and storing
  // the private key in localStorage.
  window.walletConnection.requestSignIn(nearConfig.contractName)
}

window.login = login
window.logout = logout


// ==================================================================
// import { NFTStorage } from 'nft.storage'

async function store_nft(markdown_text, api_key, autosaveUniqueId) {
  var title = markdown_text.split("\n")[0].trim().replaceAll('# ', '').substr(0, 50);
  var bearer = "Bearer " + api_key;

  var nft = {
    image: null,  // simple bro, no need image. 
    name: title,
    description: null,
    properties: {
      author: window.walletConnection.getAccountId(),
      content: {
        "text/markdown": markdown_text
      }
    }
  }

  fetch('https://api.nft.storage/upload', {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": bearer
    },
    body: JSON.stringify(nft)
  }).then((resp) => {
    return resp.json();
  }).then((jsonResp) => {
    console.log(jsonResp);
    var dataValue = jsonResp.value;

    if (jsonResp.ok == true) {
      window.FlashMessage.success("Successfully Saved to IPFS.");
      localStorage.removeItem(autosaveUniqueId);

      // Calculate storage cost then call contract with that amount. 
      window.contract.est_storage({
        "cid": dataValue.cid
      }).then((amount) => {
        window.contract.register_log({
          callbackUrl: window.location.origin,
          args: {
            "cid": dataValue.cid
          },
          gas: "300000000000000",
          amount: amount
        },);
      })

      

    } else {
      window.FlashMessage.error("Failed to save.");
      console.log(jsonResp.error);
    }
  })
}


async function get_nft(cid) {
    var response = await fetch('https://ipfs.io/ipfs/' + cid);

    if (!response.ok) {
      return { "error": "Response have problem." };
    }

    var jsonResp = await response.json();
    return jsonResp;
}


function get_from_index() {
    if (window.location.search != '') {
        var current_page = parseInt(window.location.search.split("?page=")[1].split("&")[0]);
    } else {
        var current_page = 1;
    }
    var from_index = page_limit * (current_page - 1);
    var from_index = from_index.toString();

    return from_index;
}


window.store_nft = store_nft
window.get_nft = get_nft
window.get_from_index = get_from_index
</script>
  <!-- Custom Style Outside of Bootstrap -->
<style>
  ::selection {
    color: inherit;
    background: lightblue;
  }

  .no_link {
    color: inherit;
    text-decoration: inherit;
  }

  .pb-6 {
  padding-bottom: 10rem !important;
  }
</style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">WriteLog</a>

    <button
      class="navbar-toggler bg-light"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarTogglerDemo02"
      aria-controls="navbarTogglerDemo02"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a href="/write" id="write" class="nav-link"></a>
        </li>

        <li class="nav-item">
          <a href="#" id="address" class="nav-link"></a>
        </li>

        <li class="nav-item">
          <a href="/about" class="nav-link">About</a>
        </li>

        <li class="nav-item">
          <a href="#" id="login" class="nav-link">Login</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
window.addEventListener("load", function () {
  const login = document.getElementById("login");
  const address = document.getElementById("address");
  const write = document.getElementById("write");

  var account_id = window.walletConnection.getAccountId();

  if (account_id == '') {
    login.onclick = window.login;
    address.innerText = "";
    address.href = "#";
    write.innerText = "";
  } else {
    login.onclick = window.logout;
    login.innerText = "Logout";
    address.innerText = account_id;
    address.href = "/account/" + account_id.replaceAll(".", "-");
    write.innerText = "Write";
  }
  
})
</script>
  
  %CONTENT%
</body>

<footer class="footer fixed-bottom text-center text-lg-start bg-light text-muted">
  <section class="d-flex justify-content-center justify-content-lg-between border-bottom">
    <div class="me-5 d-none d-lg-block">
      <small>
        <a href="/about">Design Ideas</a>
      </small>
    </div>
  </section>
</footer>